<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–π—Ç–∏–Ω–≥ –ë–æ–π—Ü–æ–≤ - –ü—Ä–æ–µ–∫—Ç –†–∞–∑–≥—Ä–æ–º</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="/">–ü–†–û–ï–ö–¢ –†–ê–ó–ì–†–û–ú</a>
            </div>
            <div class="nav-menu">
                <a href="/dashboard" class="nav-link">–¶–ï–ù–¢–†</a>
                <a href="/profile/<%= user.username %>" class="nav-link">–ú–û–ô –ü–†–û–§–ò–õ–¨</a>
                <a href="/journal" class="nav-link">–ë–û–ï–í–û–ô –ñ–£–†–ù–ê–õ</a>
                <a href="/rating" class="nav-link active">–†–ï–ô–¢–ò–ù–ì</a>
                <a href="/fun" class="nav-link">–†–ê–ó–í–õ–ï–ß–ï–ù–ò–Ø</a>
                <a href="/chronicle" class="nav-link">–•–†–û–ù–ò–ö–ê</a>
                <a href="/logout" class="nav-link nav-logout">–í–´–•–û–î</a>
            </div>
        </nav>

        <header class="rating-header">
            <h1>–†–ï–ô–¢–ò–ù–ì –ë–û–ô–¶–û–í</h1>
            <p class="rating-subtitle">/// –¢–ê–ë–õ–ò–¶–ê –ü–û–ß–ï–¢–ê –ò –ë–ï–ó–£–ú–ò–Ø ///</p>
        </header>

        <main class="rating-main">
            <div class="rating-info">
                <div class="info-card">
                    <h3>–ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ –†–ï–ô–¢–ò–ù–ì?</h3>
                    <ul>
                        <li>–ì–æ–ª–æ—Å—É–π –∑–∞ —Ç–æ–≤–∞—Ä–∏—â–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Å–ª—É–∂–∏–≤–∞—é—Ç –ø—Ä–∏–∑–Ω–∞–Ω–∏—è</li>
                        <li>–ö–∞–∂–¥—ã–π –≥–æ–ª–æ—Å = +1 –∫ —Ä–µ–π—Ç–∏–Ω–≥—É</li>
                        <li>–ù–µ–ª—å–∑—è –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞ —Å–µ–±—è</li>
                        <li>–†–µ–π—Ç–∏–Ω–≥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ</li>
                    </ul>
                </div>
            </div>

            <div class="rating-table">
                <h2>–¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í</h2>
                
                <% if (users.length > 0) { %>
                    <div class="fighters-list">
                        <% users.forEach((fighter, index) => { %>
                            <div class="fighter-card <%= fighter.username === user.username ? 'own-card' : '' %>">
                                <div class="fighter-rank">
                                    <div class="rank-number">#<%= index + 1 %></div>
                                    <% if (index === 0) { %>
                                        <div class="rank-crown">üëë</div>
                                    <% } else if (index === 1) { %>
                                        <div class="rank-medal">ü•à</div>
                                    <% } else if (index === 2) { %>
                                        <div class="rank-medal">ü•â</div>
                                    <% } %>
                                </div>

                                <div class="fighter-info">
                                    <div class="fighter-photo">
                                        <% if (fighter.photo) { %>
                                            <img src="/uploads/<%= fighter.photo %>" alt="<%= fighter.username %>">
                                        <% } else { %>
                                            <div class="photo-placeholder">
                                                <span>üì∑</span>
                                            </div>
                                        <% } %>
                                    </div>

                                    <div class="fighter-details">
                                        <div class="fighter-name">
                                            <a href="/profile/<%= fighter.username %>" class="name-link">
                                                <%= fighter.username %>
                                            </a>
                                            <% if (fighter.fightName) { %>
                                                <div class="fight-name">"<%= fighter.fightName %>"</div>
                                            <% } %>
                                        </div>

                                        <div class="fighter-stats">
                                            <span class="stat-item">
                                                üèÜ <%= fighter.achievements ? fighter.achievements.length : 0 %> –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
                                            </span>
                                            <span class="stat-item">
                                                üìÖ –í –∫–ª—É–±–µ —Å <%= new Date(fighter.joinDate).toLocaleDateString('ru-RU') %>
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="fighter-rating">
                                    <div class="rating-score">
                                        <span class="score-number"><%= fighter.rating || 0 %></span>
                                        <span class="score-label">‚≠ê</span>
                                    </div>

                                    <% if (fighter.username !== user.username) { %>
                                        <button class="btn btn-vote" onclick="voteForFighter('<%= fighter.username %>', this)">
                                            –û–¢–î–ê–¢–¨ –ì–û–õ–û–°
                                        </button>
                                    <% } else { %>
                                        <div class="own-marker">–¢–´</div>
                                    <% } %>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                <% } else { %>
                    <div class="no-fighters">
                        <div class="no-fighters-icon">üë•</div>
                        <h3>–ë–û–ô–¶–û–í –ù–ï–¢</h3>
                        <p>–ë—É–¥—å –ø–µ—Ä–≤—ã–º –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ!</p>
                    </div>
                <% } %>
            </div>

            <div class="rating-legend">
                <h3>–õ–ï–ì–ï–ù–î–ê –†–ï–ô–¢–ò–ù–ì–ê:</h3>
                <div class="legend-items">
                    <div class="legend-item">
                        <span class="legend-icon">üëë</span>
                        <span class="legend-text">–ö–æ—Ä–æ–ª—å –∫–ª—É–±–∞</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-icon">ü•à</span>
                        <span class="legend-text">–ü—Ä–∞–≤–∞—è —Ä—É–∫–∞</span>
                    </div>
                    <div class="legend-item">
                        <span class="legend-icon">ü•â</span>
                        <span class="legend-text">–í–µ—Ä–Ω—ã–π –±–æ–µ—Ü</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/js/main.js"></script>
    <script>
        async function voteForFighter(username, button) {
            try {
                const response = await fetch(`/vote/${username}`, { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                    const scoreElement = button.parentElement.querySelector('.score-number');
                    scoreElement.textContent = data.newRating;
                    
                    // –ò–∑–º–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É
                    button.textContent = '–ì–û–õ–û–° –û–¢–î–ê–ù!';
                    button.disabled = true;
                    button.classList.add('voted');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    showNotification(`–ì–æ–ª–æ—Å –∑–∞ ${username} –æ—Ç–¥–∞–Ω! –ù–æ–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥: ${data.newRating}`, 'success');
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                    setTimeout(() => location.reload(), 2000);
                } else {
                    showNotification(data.error, 'error');
                }
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏', 'error');
            }
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>
