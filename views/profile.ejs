<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ—Å—å–µ –ë–æ–π—Ü–∞: <%= profile.username %> - –ü—Ä–æ–µ–∫—Ç –†–∞–∑–≥—Ä–æ–º</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <%- include('partials/sidebar') %>
    
    <div class="container">
        <nav class="main-nav">
            <div class="nav-brand">
                <a href="/">–ü–†–û–ï–ö–¢ –†–ê–ó–ì–†–û–ú</a>
            </div>
            <div class="nav-menu">
                <a href="/dashboard" class="nav-link">–¶–ï–ù–¢–†</a>
                <a href="/profile/<%= user.username %>" class="nav-link <%= isOwner ? 'active' : '' %>">–ú–û–ô –ü–†–û–§–ò–õ–¨</a>
                <a href="/journal" class="nav-link">–ë–û–ï–í–û–ô –ñ–£–†–ù–ê–õ</a>
                <a href="/rating" class="nav-link">–†–ï–ô–¢–ò–ù–ì</a>
                <a href="/fun" class="nav-link">–†–ê–ó–í–õ–ï–ß–ï–ù–ò–Ø</a>
                <a href="/chronicle" class="nav-link">–•–†–û–ù–ò–ö–ê</a>
                <a href="/logout" class="nav-link nav-logout">–í–´–•–û–î</a>
            </div>
        </nav>

        <header class="profile-header">
            <h1>–î–û–°–¨–ï –ë–û–ô–¶–ê: <%= profile.username.toUpperCase() %></h1>
            <% if (!isOwner) { %>
                <div class="profile-actions">
                    <button class="btn btn-secondary" onclick="voteForUser('<%= profile.username %>')">
                        –û–¢–î–ê–¢–¨ –ì–û–õ–û–° ‚≠ê
                    </button>
                </div>
            <% } %>
        </header>

        <main class="profile-main">
            <div class="profile-layout">
                <div class="profile-info">
                    <div class="profile-photo-section">
                        <div class="photo-container">
                            <% if (profile.photo) { %>
                                <img src="/uploads/<%= profile.photo %>" alt="–§–æ—Ç–æ <%= profile.username %>" class="profile-photo">
                            <% } else { %>
                                <div class="photo-placeholder">
                                    <div class="photo-icon">üì∑</div>
                                    <div class="photo-text">–ù–ï–¢ –§–û–¢–û</div>
                                </div>
                            <% } %>
                        </div>
                        
                        <% if (isOwner) { %>
                            <form method="POST" action="/profile/<%= profile.username %>" enctype="multipart/form-data" class="photo-upload-form">
                                <input type="file" id="photo" name="photo" accept="image/*" style="display: none;">
                                <label for="photo" class="btn btn-secondary btn-small">–ó–ê–ì–†–£–ó–ò–¢–¨ –§–û–¢–û</label>
                                <button type="submit" class="btn btn-primary btn-small">–°–û–•–†–ê–ù–ò–¢–¨</button>
                            </form>
                        <% } %>
                    </div>

                    <div class="profile-stats">
                        <div class="stat-item">
                            <span class="stat-label">–†–µ–π—Ç–∏–Ω–≥:</span>
                            <span class="stat-value"><%= profile.rating || 0 %> ‚≠ê</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">–î–æ—Å—Ç–∏–∂–µ–Ω–∏–π:</span>
                            <span class="stat-value"><%= profile.achievements ? profile.achievements.length : 0 %> üèÜ</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">–í –∫–ª—É–±–µ —Å:</span>
                            <span class="stat-value"><%= new Date(profile.joinDate).toLocaleDateString('ru-RU') %></span>
                        </div>
                    </div>
                </div>

                <div class="profile-details">
                    <% if (isOwner) { %>
                        <form method="POST" action="/profile/<%= profile.username %>" class="profile-form">
                            <div class="form-group">
                                <label for="fightName">–ë–û–ï–í–û–ï –ò–ú–Ø:</label>
                                <input type="text" id="fightName" name="fightName" 
                                       value="<%= profile.fightName || '' %>" 
                                       placeholder="–¢–≤–æ–π –±–æ–µ–≤–æ–π –ø—Å–µ–≤–¥–æ–Ω–∏–º...">
                                <div class="input-help">–ö–∞–∫ —Ç–µ–±—è –±—É–¥—É—Ç –∑–Ω–∞—Ç—å –≤ –±–æ—é</div>
                            </div>

                            <div class="form-group">
                                <label for="bio">–õ–ò–ß–ù–û–ï –î–û–°–¨–ï:</label>
                                <textarea id="bio" name="bio" rows="8" 
                                          placeholder="–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ, —Å–≤–æ–∏—Ö –ø—Ä–∞–≤–∏–ª–∞—Ö, –¥–µ–≤–∏–∑–∞—Ö..."><%= profile.bio || '' %></textarea>
                                <div class="input-help">–¢–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è, –ø—Ä–∞–≤–∏–ª–∞, —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è –∂–∏–∑–Ω–∏</div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">–°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø</button>
                            </div>
                        </form>
                    <% } else { %>
                        <div class="profile-display">
                            <div class="info-section">
                                <h3>–ë–û–ï–í–û–ï –ò–ú–Ø:</h3>
                                <p class="fight-name"><%= profile.fightName || '–ù–ï –£–ö–ê–ó–ê–ù–û' %></p>
                            </div>

                            <div class="info-section">
                                <h3>–õ–ò–ß–ù–û–ï –î–û–°–¨–ï:</h3>
                                <div class="bio-content">
                                    <% if (profile.bio) { %>
                                        <p><%= profile.bio %></p>
                                    <% } else { %>
                                        <p class="no-info">–ò–ù–§–û–†–ú–ê–¶–ò–Ø –ó–ê–°–ï–ö–†–ï–ß–ï–ù–ê</p>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    <% } %>

                    <div class="achievements-section">
                        <h3>–ë–û–ï–í–´–ï –î–û–°–¢–ò–ñ–ï–ù–ò–Ø:</h3>
                        
                        <% if (profile.achievements && profile.achievements.length > 0) { %>
                            <div class="achievements-list">
                                <% profile.achievements.forEach(achievement => { %>
                                    <div class="achievement-item">
                                        <div class="achievement-icon">üèÜ</div>
                                        <div class="achievement-content">
                                            <div class="achievement-text"><%= achievement.text %></div>
                                            <div class="achievement-date">
                                                <%= new Date(achievement.date).toLocaleDateString('ru-RU') %>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        <% } else { %>
                            <p class="no-achievements">–î–û–°–¢–ò–ñ–ï–ù–ò–Ø –ü–û–ö–ê –ù–ï –ó–ê–†–ê–ë–û–¢–ê–ù–´</p>
                        <% } %>

                        <% if (isOwner) { %>
                            <div class="add-achievement">
                                <form method="POST" action="/add-achievement" class="achievement-form">
                                    <div class="form-group">
                                        <input type="text" name="achievement" 
                                               placeholder="–ù–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ..." required>
                                        <button type="submit" class="btn btn-secondary">–î–û–ë–ê–í–ò–¢–¨</button>
                                    </div>
                                </form>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/js/main.js"></script>
    <script>
        async function voteForUser(username) {
            try {
                const response = await fetch(`/vote/${username}`, { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    alert(`–ì–æ–ª–æ—Å –æ—Ç–¥–∞–Ω! –ù–æ–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥: ${data.newRating}`);
                    location.reload();
                } else {
                    alert(data.error);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏');
            }
        }
    </script>
</body>
</html>
